<!DOCTYPE html>
{% load static %}
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AI Engineering Roadmap</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="{% static 'css/rd.css' %}">
</head>
<body class="hero-bg">
    <div class="floating-particles" id="particles"></div>
    
    <div class="min-h-screen py-12 px-4 relative z-10">
        <div class="max-w-4xl mx-auto">
            <div class="text-center mb-12 fade-in-up">
                <h1 class="text-5xl font-bold text-white title-glow mb-4" data-roadmap-type="{{ roadmap_type }}">
                    {{ roadmap_metadata.title }}
                </h1>
                <p class="text-xl text-white/80 mb-8">
                    {{ roadmap_metadata.description }}
                </p>
                
                <div class="progress-bar">
                    <div class="progress-fill" id="progressFill" style="width: {{ progress_percentage }}%"></div>
                </div>
                <p class="text-white/70 mt-2">
                    Progress: <span id="progressText">{{ completed_count }}/{{ total_nodes }}</span> completed
                </p>
            </div>

            <div class="roadmap-container rounded-2xl p-8 space-y-8">
                <div class="roadmap-node rounded-xl p-6 shadow-lg" data-node="1">
                    <div class="flex items-center">
                        <label class="custom-checkbox">
                            <input type="checkbox" class="node-checkbox" 
                                   data-node="1" 
                                   data-roadmap="{{ roadmap_type }}"
                                   {% if user_progress.1 %}checked{% endif %}>
                            <span class="checkmark"></span>
                        </label>
                        <div class="node-icon">1</div>
                        <div class="flex-1">
                            <h3 class="text-xl font-semibold text-white">Foundational Math & Statistics</h3>
                            <p class="text-white/80 mt-1">Grasp the mathematical backbone of AI</p>
                        </div>
                        <div class="svg-icon">
                            <img src="https://www.svgrepo.com/show/511394/calculator.svg" alt="Math Icon">
                        </div>
                    </div>
                    <div class="content-area">
                        <div class="flex flex-wrap gap-2 mt-4">
                            <a href="https://www.khanacademy.org/math/linear-algebra" target="_blank" class="resource-link">Linear Algebra</a>
                            <a href="https://www.khanacademy.org/math/calculus-1" target="_blank" class="resource-link">Calculus</a>
                            <a href="https://www.khanacademy.org/math/statistics-probability" target="_blank" class="resource-link">Probability & Statistics</a>
                        </div>
                    </div>
                    <div class="roadmap-path"></div>
                </div>

                <div class="roadmap-node rounded-xl p-6 shadow-lg" data-node="2">
                    <div class="flex items-center">
                        <label class="custom-checkbox">
                            <input type="checkbox" class="node-checkbox" 
                                   data-node="2" 
                                   data-roadmap="{{ roadmap_type }}"
                                   {% if user_progress.2 %}checked{% endif %}>
                            <span class="checkmark"></span>
                        </label>
                        <div class="node-icon">2</div>
                        <div class="flex-1">
                            <h3 class="text-xl font-semibold text-white">Programming Fundamentals (Python)</h3>
                            <p class="text-white/80 mt-1">Master the primary language for AI</p>
                        </div>
                        <div class="svg-icon">
                            <img src="https://www.svgrepo.com/show/452091/python.svg" alt="Python Icon">
                        </div>
                    </div>
                    <div class="content-area">
                        <div class="flex flex-wrap gap-2 mt-4">
                            <a href="https://docs.python.org/3/" target="_blank" class="resource-link">Python Docs</a>
                            <a href="https://www.codecademy.com/learn/learn-python-3" target="_blank" class="resource-link">Codecademy Python</a>
                            <a href="https://www.datacamp.com/courses/introduction-to-python-for-data-science" target="_blank" class="resource-link">Python for Data Science</a>
                        </div>
                    </div>
                    <div class="roadmap-path"></div>
                </div>

                <!-- Continue with remaining nodes... -->
                <div class="roadmap-node rounded-xl p-6 shadow-lg" data-node="3">
                    <div class="flex items-center">
                        <label class="custom-checkbox">
                            <input type="checkbox" class="node-checkbox" 
                                   data-node="3" 
                                   data-roadmap="{{ roadmap_type }}"
                                   {% if user_progress.3 %}checked{% endif %}>
                            <span class="checkmark"></span>
                        </label>
                        <div class="node-icon">3</div>
                        <div class="flex-1">
                            <h3 class="text-xl font-semibold text-white">Data Structures & Algorithms</h3>
                            <p class="text-white/80 mt-1">Build efficient and optimized AI solutions</p>
                        </div>
                        <div class="svg-icon">
                            <img src="https://www.svgrepo.com/show/472097/data-structure.svg" alt="Data Structures Icon">
                        </div>
                    </div>
                    <div class="content-area">
                        <div class="flex flex-wrap gap-2 mt-4">
                            <a href="https://www.geeksforgeeks.org/data-structures/" target="_blank" class="resource-link">GeeksforGeeks DSA</a>
                            <a href="https://leetcode.com/" target="_blank" class="resource-link">LeetCode</a>
                            <a href="https://www.coursera.org/learn/data-structures-algorithms" target="_blank" class="resource-link">Coursera DSA</a>
                        </div>
                    </div>
                    <div class="roadmap-path"></div>
                </div>

                <!-- Add remaining nodes 4-12 following the same pattern -->
            </div>

            <div class="text-center mt-12 text-white/70">
                <p class="text-lg">ðŸ’¡ Click on each node to explore resources and check off completed topics!</p>
                <p class="mt-2">ðŸŽ¯ Track your progress and stay motivated on your AI engineering journey</p>
            </div>
        </div>
    </div>

    <!-- Enhanced JavaScript for progress tracking -->
    <script>
        document.addEventListener('DOMContentLoaded', function() {
            const checkboxes = document.querySelectorAll('.node-checkbox');
            const progressFill = document.getElementById('progressFill');
            const progressText = document.getElementById('progressText');
            
            // Get CSRF token
            function getCookie(name) {
                let cookieValue = null;
                if (document.cookie && document.cookie !== '') {
                    const cookies = document.cookie.split(';');
                    for (let i = 0; i < cookies.length; i++) {
                        const cookie = cookies[i].trim();
                        if (cookie.substring(0, name.length + 1) === (name + '=')) {
                            cookieValue = decodeURIComponent(cookie.substring(name.length + 1));
                            break;
                        }
                    }
                }
                return cookieValue;
            }
            
            const csrftoken = getCookie('csrftoken');
            
            // Handle checkbox changes
            checkboxes.forEach(checkbox => {
                checkbox.addEventListener('change', function() {
                    const nodeNumber = this.getAttribute('data-node');
                    const roadmapType = this.getAttribute('data-roadmap');
                    const completed = this.checked;
                    
                    // Send AJAX request to update progress
                    fetch('/roadmaps/api/update-progress/', {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json',
                            'X-CSRFToken': csrftoken
                        },
                        body: JSON.stringify({
                            roadmap_type: roadmapType,
                            node_number: nodeNumber,
                            completed: completed
                        })
                    })
                    .then(response => response.json())
                    .then(data => {
                        if (data.success) {
                            // Update progress bar
                            progressFill.style.width = data.progress_percentage + '%';
                            progressText.textContent = data.completed_count + '/' + data.total_nodes;
                            
                            // Optional: Show success message
                            console.log('Progress updated successfully');
                        } else {
                            console.error('Error updating progress:', data.error);
                            // Revert checkbox state on error
                            this.checked = !completed;
                        }
                    })
                    .catch(error => {
                        console.error('Error:', error);
                        // Revert checkbox state on error
                        this.checked = !completed;
                    });
                });
            });
        });
    </script>
    
    <script src="{% static 'js/main.js' %}"></script>
</body>
</html>